<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jogo dos C√≠rculos</title>
  <style>
    :root { --bg:#0f2530; --fg:#e8f6ff; --accent:#7dfac3; --chip:#0c1b23; --chip-b:#12313f }
    * { box-sizing:border-box }
    body { margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,Segoe UI,Roboto,Arial }
    header { text-align:center; padding:24px 16px }
    h1 { margin:0 0 8px; font-weight:800; letter-spacing:.3px }
    .hud { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; opacity:.95 }
    .chip { background:var(--chip); padding:8px 14px; border-radius:999px; border:1px solid var(--chip-b); display:flex; gap:6px; align-items:center }
    .wrap { display:grid; place-items:center; padding:16px }
    canvas { width:min(1000px, 94vw); height:min(560px, 64vh); border-radius:16px; box-shadow:0 10px 26px rgba(0,0,0,.35); background:radial-gradient(1200px 600px at 10% 10%, #103848 0, #09161d 55%, #071118 100%) }
    .btn { appearance:none; border:0; background:var(--accent); color:#072224; padding:12px 18px; border-radius:12px; font-weight:700; cursor:pointer; transition:transform .12s ease, filter .2s;
           box-shadow:0 6px 18px rgba(125,250,195,.25) }
    .btn:active { transform:translateY(1px) }
    .btn.secondary { background:#0f3d4f; color:#cfeefb }
    .controls { margin:14px 0 0; display:flex; gap:10px; justify-content:center; flex-wrap:wrap }
    select { background:var(--chip); color:var(--fg); border:1px solid var(--chip-b); border-radius:10px; padding:10px 12px }
    footer { text-align:center; opacity:.6; font-size:12px; padding:8px 0 18px }
    dialog { border:1px solid var(--chip-b); background:#07151b; color:var(--fg); border-radius:14px; padding:16px 16px 10px; width:min(520px,94vw) }
    dialog::backdrop{ background:rgba(0,0,0,.45) }
    table { width:100%; border-collapse:collapse; font-size:14px }
    th,td{ padding:8px 6px; border-bottom:1px dashed #143443; text-align:left }
    th{ opacity:.8; font-weight:700 }
    .right { text-align:right }
  </style>
</head>
<body>
  <header>
    <h1>Jogo dos C√≠rculos</h1>
    <div class="hud">
      <div class="chip">‚è±Ô∏è <b>Tempo:</b> <span id="t">60</span>s</div>
      <div class="chip">‚≠ê <b>Pontos:</b> <span id="p">0</span></div>
      <div class="chip">üéØ <b>Acertos:</b> <span id="h">0</span> ‚Ä¢ <b>Erros:</b> <span id="m">0</span></div>
      <div class="chip">‚öôÔ∏è <b>Dificuldade:</b> <span id="dlabel">Normal</span></div>
    </div>
    <p style="opacity:.8;margin:10px 0 0">Clique nos c√≠rculos brilhantes para ganhar pontos. Desvie dos vermelhos!</p>
    <div class="controls">
      <button id="start" class="btn">Come√ßar</button>
      <button id="share" class="btn secondary">Compartilhar</button>
      <button id="board" class="btn secondary">Ranking</button>
      <label class="chip" style="gap:8px">üéöÔ∏è Modo
        <select id="diff">
          <option value="normal">Normal</option>
          <option value="hard">Dif√≠cil</option>
        </select>
      </label>
    </div>
  </header>

  <div class="wrap"><canvas id="game" width="1024" height="576"></canvas></div>
  <footer>Feito para rodar feliz no GitHub Pages üòé ‚Äî agora com <b>sons</b>, <b>ranking local</b>, <b>explos√µes</b> e <b>modo dif√≠cil</b>.</footer>

  <dialog id="dlg">
    <h3 style="margin:0 0 8px">üèÜ Ranking local (top 10)</h3>
    <table id="tbl"></table>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="reset" class="btn secondary">Limpar</button>
      <button id="close" class="btn">Fechar</button>
    </div>
  </dialog>

  <script>
    // ===== Util =====
    const cvs = document.getElementById('game'), ctx = cvs.getContext('2d');
    const ui = { t: q('#t'), p: q('#p'), h: q('#h'), m: q('#m'), dlabel:q('#dlabel'), start: q('#start'), share:q('#share'), board:q('#board'), diff:q('#diff') };
    const dlg = q('#dlg'), tbl=q('#tbl'), btnClose=q('#close'), btnReset=q('#reset');
    const DPR = window.devicePixelRatio || 1; fitCanvas();

    function q(s){ return document.querySelector(s) }
    function fitCanvas(){ if(DPR!==1){ const w=cvs.width,h=cvs.height; cvs.width=w*DPR; cvs.height=h*DPR; cvs.style.width=w+'px'; cvs.style.height=h+'px'; ctx.setTransform(DPR,0,0,DPR,0,0);} }
    const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
    const rand=(a,b)=>Math.random()*(b-a)+a;
    const now=()=>performance.now();

    // ===== √Åudio (WebAudio, sem arquivos externos) =====
    let actx; const ensureAudio=()=>{ if(!actx){ actx = new (window.AudioContext||window.webkitAudioContext)(); }};
    function beep(freq=440, type='sine', duration=0.08, vol=0.15){ try{ ensureAudio(); const o=actx.createOscillator(), g=actx.createGain(); o.type=type; o.frequency.value=freq; o.connect(g); g.connect(actx.destination); g.gain.value=vol; o.start(); g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime+duration); o.stop(actx.currentTime+duration); }catch(e){} }
    const sfx = { good:()=>{ beep(740,'sine',0.07,0.18); beep(980,'sine',0.09,0.12); }, bad:()=>{ beep(180,'square',0.1,0.18); }, miss:()=>{ beep(260,'sawtooth',0.06,0.12); }, end:()=>{ beep(520,'triangle',0.2,0.2);} };

    // ===== Estado do jogo =====
    let circles=[], particles=[]; let score=0, hits=0, miss=0, time=60, playing=false, last=0, timerId; let level=1;

    function colorGood(){ return `hsl(${rand(140,170)},100%,${rand(55,70)}%)` }
    function colorBad(){ return `hsl(${rand(350,10)},95%,${rand(50,65)}%)` }

    function spawn(){
      const hard = ui.diff.value==='hard';
      const speed = hard? 1.4 : 1.0;
      const probBad = clamp(0.18 + level*(hard?0.05:0.03), 0.18, hard?0.65:0.45);
      const isBad = Math.random() < probBad;
      const baseR = hard? 13 : 16;
      const r = rand(baseR, baseR + 18 + level*1.5);
      const obj={
        x: rand(r, cvs.width/DPR - r), y: rand(r, cvs.height/DPR - r),
        r, vx: rand(-1.2-level*.15, 1.2+level*.15)*speed, vy: rand(-1.2-level*.15, 1.2+level*.15)*speed,
        life: (hard?2.2:3.2) + level*0.22, bad:isBad, glow: 0, shrink: hard? rand(0.002,0.006): 0
      };
      circles.push(obj);
    }

    function start(){
      circles=[]; particles=[]; score=0; hits=0; miss=0; time=60; level=1; playing=true;
      ui.p.textContent=0; ui.h.textContent=0; ui.m.textContent=0; ui.t.textContent=60; ui.dlabel.textContent = ui.diff.options[ui.diff.selectedIndex].text;
      for(let i=0;i<10;i++) spawn();
      clearInterval(timerId);
      timerId = setInterval(()=>{ time--; ui.t.textContent=time; if(time<=0) stop(); else { level = Math.floor((60-time)/6)+1; spawn(); if(Math.random()<0.6) spawn(); } },1000);
      last = now(); requestAnimationFrame(loop);
      ensureAudio();
    }

    function stop(){
      playing=false; clearInterval(timerId); sfx.end();
      saveScore({score,hits,miss,mode:ui.diff.value,ts:Date.now()});
      alert(`Fim! Pontos: ${score} ‚Ä¢ Acertos: ${hits} ‚Ä¢ Erros: ${miss} ‚Ä¢ Modo: ${ui.diff.value==='hard'?'Dif√≠cil':'Normal'}`);
      renderBoard();
    }

    function loop(t){
      const dt = Math.min(33,(t-last))/16.67; last=t;
      // mover c√≠rculos
      for(const c of circles){
        c.x += c.vx*dt; c.y += c.vy*dt; c.glow = Math.max(0, c.glow - 0.05*dt); c.r = Math.max(8, c.r - c.shrink*dt*60);
        if(c.x<c.r||c.x>cvs.width/DPR-c.r) c.vx*=-1;
        if(c.y<c.r||c.y>cvs.height/DPR-c.r) c.vy*=-1;
        c.life -= 0.015*dt;
      }
      circles = circles.filter(c=>c.life>0);
      while (circles.length < 12) spawn();
      // mover part√≠culas
      for(const p of particles){ p.x+=p.vx*dt; p.y+=p.vy*dt; p.life-=0.03*dt; p.vy+=0.01*dt; }
      particles = particles.filter(p=>p.life>0);

      // render
      ctx.clearRect(0,0,cvs.width,DPR?cvs.height:576);
      // leve textura
      for(let i=0;i<10;i++){ ctx.globalAlpha=0.02; ctx.fillStyle='#0b2130'; ctx.fillRect(rand(0,cvs.width), rand(0,cvs.height), rand(40,140), rand(2,6)); }
      ctx.globalAlpha=1;
      for(const c of circles){
        ctx.beginPath(); ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
        const grad = ctx.createRadialGradient(c.x,c.y,2,c.x,c.y,c.r*1.4);
        const col = c.bad ? colorBad() : colorGood();
        grad.addColorStop(0,'#ffffff'); grad.addColorStop(.25,col); grad.addColorStop(1,'rgba(0,0,0,.15)');
        ctx.fillStyle = grad; ctx.fill();
        ctx.save(); ctx.globalAlpha = Math.max(0, Math.min(1, c.glow));
        ctx.beginPath(); ctx.arc(c.x,c.y,c.r*1.7,0,Math.PI*2); ctx.strokeStyle = col; ctx.lineWidth = 4; ctx.stroke();
        ctx.restore();
      }
      // part√≠culas
      for(const p of particles){ ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
      ctx.globalAlpha=1;

      if(playing) requestAnimationFrame(loop);
    }

    function explode(x,y,color){
      for(let i=0;i<18;i++) particles.push({ x, y, r: rand(1,2.2), vx: rand(-2.2,2.2), vy: rand(-2.2,2.2), life: 1, color });
    }

    cvs.addEventListener('click', e=>{
      if(!playing) return;
      const rect = cvs.getBoundingClientRect();
      const x = (e.clientX - rect.left), y = (e.clientY - rect.top);
      let hit = false;
      for(const c of circles){
        const dx=x-c.x, dy=y-c.y; if(dx*dx+dy*dy <= c.r*c.r){
          hit = true; c.life = 0; c.glow = 1.0; const col = c.bad ? colorBad() : colorGood(); explode(c.x,c.y,col);
          if(c.bad){ score = Math.max(0, score-2); miss++; sfx.bad(); } else { score += 3; hits++; sfx.good(); }
          ui.p.textContent = score; ui.h.textContent = hits; ui.m.textContent = miss;
          break;
        }
      }
      if(!hit){ score = Math.max(0, score-1); ui.p.textContent=score; sfx.miss(); }
    });

    ui.start.addEventListener('click', ()=> start());
    ui.diff.addEventListener('change', ()=>{ ui.dlabel.textContent = ui.diff.options[ui.diff.selectedIndex].text; });

    // ===== Ranking local =====
    const LSKEY='circles_scores_v2';
    function loadScores(){ try{ return JSON.parse(localStorage.getItem(LSKEY)||'[]'); }catch(e){ return []; } }
    function saveScore(obj){ const arr=loadScores(); arr.push(obj); arr.sort((a,b)=>b.score-a.score); const top=arr.slice(0,10); localStorage.setItem(LSKEY, JSON.stringify(top)); }
    function renderBoard(){ const arr=loadScores(); if(!arr.length){ tbl.innerHTML='<tr><td>Nenhum resultado salvo ainda.</td></tr>'; } else {
        tbl.innerHTML='<tr><th>#</th><th>Pontos</th><th>Acertos</th><th>Erros</th><th>Modo</th><th class="right">Quando</th></tr>' +
          arr.map((r,i)=>`<tr><td>${i+1}</td><td>${r.score}</td><td>${r.hits??'-'}</td><td>${r.miss??'-'}</td><td>${r.mode==='hard'?'Dif√≠cil':'Normal'}</td><td class="right">${new Date(r.ts).toLocaleString()}</td></tr>`).join(''); }
      if(!dlg.open) dlg.showModal(); }
    ui.board.addEventListener('click', renderBoard);
    btnClose.addEventListener('click', ()=> dlg.close());
    btnReset.addEventListener('click', ()=>{ if(confirm('Apagar ranking local?')){ localStorage.removeItem(LSKEY); renderBoard(); } });

    // ===== Compartilhar =====
    ui.share.addEventListener('click', async ()=>{
      const text=`Acertei ${hits} e fiz ${score} pontos no Jogo dos C√≠rculos (${ui.diff.value==='hard'?'Dif√≠cil':'Normal'}). Tenta bater!`;
      const url=location.href;
      try{
        if(navigator.share){ await navigator.share({ title:'Jogo dos C√≠rculos', text, url }); }
        else if(navigator.clipboard){ await navigator.clipboard.writeText(`${text} \n${url}`); alert('Copiei o texto e o link. √â s√≥ colar onde quiser!'); }
        else { prompt('Copie e compartilhe:', `${text} \n${url}`); }
      }catch(e){ /* cancelado */ }
    });
  </script>
</body>
</html>
